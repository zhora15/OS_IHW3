# ИДЗ 2

## Вариант 17
Задача о нелюдимых садовниках. Имеется пустой участок земли (двумерный массив) и план сада, разбитого на 
отдельные квадраты. От 10 до 30 процентов площади сада заняты прудами или камнями. То есть недоступны для 
ухаживания. Эти квадраты располагаются на плане произвольным образом. Ухаживание за садом выполняют два 
садовника, которые не хотят встречаться друг другом (то есть, одновременно появляться в одном и том же 
квадрате). Первый садовник начинает работу с верхнего левого угла сада и перемещается слева направо, сделав
ряд, он спускается вниз и идет в обратном направлении, пропуская обработанные участки. Второй садовник 
начинает работу с нижнего правого угла сада и перемещается снизу вверх, сделав ряд, он перемещается влево 
и также идет в обратную сторону. Если садовник видит, что участок сада уже обработан другим садовником 
или является необрабатываемым, он идет дальше. Если по пути какой-то участок занят другим садовником, то 
садовник ожидает когда участок освободится, чтобы пройти дальше. Садовники должны работать одновременно со
скоростями, определяемыми как параметры задачи. Прохождение через любой квадрат занимает некоторое время, 
которое задается константой, меньшей чем времена обработки и принимается за единицу времени. Создать 
приложение, моделирующее работу садовников. Каждого садовника представить отдельным клиентом. Сам сад — сервер.

## Компиляция и запуск
### На 4-5
Компиляция бинарных файлов происходит нижеперечисленными командами:

`gcc ./for4/server.c utils.h -o ./for4/server -pthread -lrt`

`gcc gardener.c tools.h -o gardener`

Для запуска необходимо запустить исполняемые файлы с необходимыми аргументами строго в данной последовательности:

`./for6/server <Server Port>`

`./gardener <Server IP> <Server Port> <N> <SPD>`

`./gardener <Server IP> <Server Port> <N> <SPD>`

где `<Server IP>` - IP-адрес сервера, `<Server Port>` - порт сервера, `N` - номер садовника (1 или 2), 
`SPD` - занимаемое время на обработку одной ячейки поля в введенных единицах измерения.

### На 6-7
Вдобавок к командам компиляции для предыдущей оценки необходимо скомпилировать клиента - обозревателя:

`gcc ./6/observer.c utils.h -o ./6/obs`

Для запуска необходимо запустить исполняемые файлы с необходимыми аргументами строго в данной последовательности:

`./6/server <Server Port>`

`./gardener <Server IP> <Server Port> <N> <SPD>`

`./gardener <Server IP> <Server Port> <N> <SPD>`

`./6/obs <Server IP> <Server Port>`

где `<Server IP>` - IP-адрес сервера, `<Server Port>` - порт сервера, `N` - номер садовника (1 или 2),
`SPD` - занимаемое время на обработку одной ячейки поля в введенных единицах измерения.

## Заголовочный файл

Заголовочный файл содержит:
<ol>
<li>Подключение внешних библиотек
<li>Макросы идентификаторов
<li>Объявление структуры клетки поля
<li>Объвление глобальных переменных
</ol>

### На 4
Структура `cell` содержит текущее состояние (занято камнем или прудом, не обработано или указано каким работником обработано) и семафор, отвечающий за производимые в данной момент работы на клетке поля.
Перед выполнением основго кода программы записывается указатель на функцию, отрабатывающую сигнал, чтобы в будущем дочерний процесс не отрабатывал дважды сигнал `Ctrl+C`.
В начале работы программы выделяется разделяемая память `field`, в которой хранятся структуры `cell`, соответствующие каждой клетки поля. Затем генерируются название для семафоров и их создаение.
Далее генерируются клетки, которые будут заняты камнем или прудом.
После инициализации создаются два дочерних потока, которые дожидаются подключения клиентов-садовников и
обрабатывают входящие запросы. Клиент садовник может отправить 4 разных запроса: `GARDENER_START`, `GARDENER_FINISH`, 
`ADD_GARDENER`, `END_GARDENER`.
`ADD_GARDENER` - отвечает за инициализацию, принимает номер садовника и возращает размер поля и единцу времени в мс.

`END_GARDENER` - отвечает за прекращения работы процесса обработки клиента, так как садовник закончил работу.

`GARDENER_START` - отвечает за обработку новой клетки поля. Принимает координаты клетки и возвращает состояние клетки.

`GARDENER_FINISH` - отвечает за прекращение обработки клетки поля.

Клиент, получая ответ от сервера, действует согласно условию: пропускает клетку или обрабатывает клетку (выолняет задержку)

## На 6

В работе сервера создается еще один процесс, который отправляет информацию о выполнение программы другому клиенту.
Данные записываются в буффер, расположенный в разделяемой памяти. Затем каждые 100мс происходит отправка клиенту.